<?xml version="1.0"?>

<launch>
    <!-- <arg name="bagfile" default="$(env HOME)/bagfiles/rwrc23/rwrc23_main_2023-09-17-11-15-11.bag"/> -->
    <!-- <arg name="bagfile" default="$(env HOME)/bagfiles/rwrc23/rwrc23_main_2023-09-22-10-09-12.bag"/> -->
    <!-- <arg name="bagfile" default="$(env HOME)/bagfiles/rwrc23/rwrc23_main_2023-09-26-20-24-28.bag"/> -->
    <!-- <arg name="bagfile" default="/share/share/RWRC/rwrc23/bagfiles/tsukuba_23-11-04/rwrc23_main_2023-11-04-12-54-28.bag"/> -->
    <arg name="bagfile" default="/home/amsl/bagfiles/rwrc23/rwrc23_main_2023-11-18-11-36-30.bag"/>
    <arg name="use_map" default="false"/>
    <arg name="planner" default="dwa"/> <!-- dwa or pfp -->
    <arg name="planner_hz" default="20"/>

    <arg name="r" default="1.0"/>
    <arg name="s" default="0.0"/>


    <!-- dwa -->
    <group if="$(eval arg('planner')=='dwa')">
        <include file="$(find rwrc23)/launch/common/dwa.launch">
            <arg name="hz" value="$(arg planner_hz)"/>
            <arg name="use_footprint" default="true"/>
            <!-- <arg name="dwa_param" value="$(find dwa_planner)/config/dwa_param.yaml"/> -->
            <!-- <arg name="robot_param" value="$(find dwa_planner)/config/robot_param.yaml"/> -->
            <arg name="dwa_param" value="$(find rwrc23)/config/param/dwa/dwa_param.yaml"/>
            <arg name="robot_param" value="$(find rwrc23)/config/param/dwa/robot_param.yaml"/>
            <arg name="cmd_vel" value="/local_planner/dwa_planner/cmd_vel"/>
            <arg name="local_map" value="/local_map/expand"/>
            <arg name="path" value="/local_goal_creator/path"/>
            <remap from="selected_trajectory" to="/local_planner/dwa_planner/selected_trajectory"/>
            <remap from="candidate_trajectories" to="/local_planner/dwa_planner/candidate_trajectories"/>
        </include>
        <node pkg="rviz" type="rviz" name="rviz" args="-d $(find rwrc23)/config/rviz/dwa.rviz"/>
    </group>
    <!-- pfp -->
    <group if="$(eval arg('planner')=='pfp')">
        <include file="$(find rwrc23)/launch/common/pfp.launch">
            <arg name="hz" value="$(arg planner_hz)"/>
            <arg name="local_map" value="/local_map/expand"/>
            <arg name="planner_param" value="$(find rwrc23)/config/param/pfp/planner_param.yaml"/>
            <arg name="robot_param" value="$(find rwrc23)/config/param/pfp/robot_param.yaml"/>
        </include>
        <node pkg="rviz" type="rviz" name="rviz" args="-d $(find point_follow_planner)/config/rviz.rviz"/>
    </group>
    <!-- footprint -->
    <node pkg="amsl_navigation_utils" type="footprint_publisher" name="footprint_publisher" output="screen">
        <rosparam command="load" file="$(find rwrc23)/config/param/footprint/robot_param.yaml"/>
    </node>


    <!-- localmap_creator -->
    <group unless="$(arg use_map)">
        <include file="$(find velodyne_pointcloud)/launch/VLP-32C_points.launch"/>
        <include file="$(find rwrc23)/launch/common/localmap_creator.launch">
            <arg name="local_map_expansion" value="0.03"/>
        </include>
    </group>

    <!-- bag_play -->
    <rosparam param="/use_sim_time">true</rosparam>
    <node pkg="rosbag" type="play" name="rosbag_play" output="screen" if="$(arg use_map)" args="
        $(arg bagfile)
        --clock
        -r $(arg r)
        -s $(arg s)
        --topics
        /local_goal
        /local_goal_creator/path
        /odom
        /scan
        /tf
        /tf_static
        /local_map/expand
        /grasscam/image_raw/compressed
        ">
    </node>
    <node pkg="rosbag" type="play" name="rosbag_play" output="screen" unless="$(arg use_map)" args="
        $(arg bagfile)
        --clock
        -r $(arg r)
        -s $(arg s)
        --topics
        /local_goal
        /local_goal_creator/path
        /odom
        /scan
        /tf
        /tf_static
        /velodyne_packets
        /front_hokuyo/scan
        /back_hokuyo/scan
        /grasscam/image_raw/compressed
        ">
    </node>
</launch>
